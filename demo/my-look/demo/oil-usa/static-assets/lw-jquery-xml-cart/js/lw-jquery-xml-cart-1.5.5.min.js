/*!
    jQuery XML Store / Shop - Shopping Cart
    Created by LivelyWorks - http://livelyworks.net
    Ver. 1.5.5 - 02 DEC 2014
*/
;$(document).ready(function(){_.templateSettings.variable="_oData";var n={configXMLFile:"data-provider/config.xml",productsXMLFile:"data-provider/products.xml",storeName:"",logoImage:"",currencySymbol:"$",currency:"USD",businessEmail:"",usePaypal:true,useSubmitOrderByEmail:true,shippingCharges:0,searchProductDetails:true,bs3Theme:$("body").hasClass("bs-3")?true:false,paypalBaseURL:"https://www.paypal.com/cgi-bin/webscr?cmd=_cart&upload=1&charset=utf-8&currency_code=",submitOrderBaseURL:"scripts/cart-mailer.php?currency_code="},c={},o={},d={},q={},k={},m=new Array(),l=new Date(),h={},p="",j={color:null,size:null},b=false,g={categoryIdentfierInURL:"uid-",isStoreLoaded:false,lastAccessedCategory:null,hashChanged:false,preventHashChangedAction:false,cartStorageName:"store-cart-storage"+window.location.hostname,qtyUpdateTimeout:null,searchDelayTimeout:null,showSubmitOrderTimeout:null,enableOrderBtn:false,isDemoActivate:false,preventHashChange:false},i={storeLogo:$("#storeLogo"),checkoutWithPaypalBtn:$("#checkoutWithPaypal"),checkoutSubmitOrderBtn:$("#checkoutSubmitOrder"),loaderContainer:$("#loaderContainer"),mainContainer:$("#mainContainer"),modalCommon:$("#commonModal"),modalContainer:n.bs3Theme?$(".common-modal-content"):$("#commonModal"),categoriesList:$("#categoriesList"),storeLoaderStatusText:$(".lw-loading-status"),productsContainer:$("#productsContainer"),storeWaitingText:$(".lw-waiting-text"),addToCartBtnContainer:$("#addToCartBtnContainer"),productsBreadcrumb:$("#productsBreadcrumb"),shoppingCartBtnContainer:$(".shopping-cart-btn-container"),searchInput:$("input.search-product"),clearSearchBtn:$(".clear-search-result-btn"),footerStoreName:$(".footer-store-name"),goToTop:$(".go-to-top"),searchedProductCounts:$("#searchedProductCounts")},a={sidebarCategories:_.template($("script.sidebar-catgegories-template").html()),productsGrid:_.template($("script.products-grid-template").html()),productsDetailsModal:_.template($("script.products-details-modal-template").html()),shoppingCartModal:_.template($("script.shopping-cart-template").html()),addToCartBtn:_.template($("script.add-to-cart-btn-template").html()),shoppingCartBtn:_.template($("script.shopping-cart-btn-template").html()),submitOrderFormModal:_.template($("script.submit-order-form-template").html())},e={fullFormatAmount:function(r){return n.currencySymbol+" "+new Number(r).toFixed(2)+" "+n.currency},formatAmount:function(r){return n.currencySymbol+" "+new Number(r).toFixed(2)},convertToSlug:function(r){return r.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"")},dataFromURL:function(){return _.object(_.compact(_.map(location.hash.slice(1).split("/"),function(r){if(r){return r.split("id-")}})))},goToTop:function(r){if(r){r.preventDefault()}$("html, body").animate({scrollTop:"0px"},{duration:200,easing:"swing"})},resizeNPositioin:function(){$("head").append("<style> .bs-2 .modal-body { max-height:"+($(window).height()*0.4)+"px;} </style>");i.loaderContainer.css({top:($(window).height()*0.5)-(i.loaderContainer.height()*0.5),left:($(window).width()*0.5)-(i.loaderContainer.width()*0.5)})}};e.resizeNPositioin();i.storeLoaderStatusText.html("Loading configurations...");$.ajax({type:"GET",url:n.configXMLFile+"?file="+l.getTime(),dataType:"xml",success:function(r){i.storeLoaderStatusText.html("Loading loaded...");var s=$(r).find("configuration")[0];n.logoImage=$(s).attr("logoImage");n.storeName=$(s).attr("storeName");i.footerStoreName.html(n.storeName);if($(s).attr("currencySymbol")){n.currencySymbol=$(s).attr("currencySymbol")}if($(s).attr("currency")){n.currency=$(s).attr("currency")}if($(s).attr("businessEmail")){n.businessEmail=$(s).attr("businessEmail")}if($(s).attr("UsePaypal")){n.usePaypal=parseInt($(s).attr("UsePaypal"))}if($(s).attr("UseSubmitOrder")){n.useSubmitOrderByEmail=parseInt($(s).attr("UseSubmitOrder"))}if($(s).attr("ShippingCharges")){n.shippingCharges=parseFloat($(s).attr("ShippingCharges"))}i.storeLogo.attr("src",n.logoImage);if(n.usePaypal==0){i.checkoutWithPaypalBtn.hide()}if(n.useSubmitOrderByEmail==0){i.checkoutSubmitOrderBtn.hide()}n.paypalBaseURL=n.paypalBaseURL+n.currency+"&business="+n.businessEmail+"&handling_cart="+n.shippingCharges;n.submitOrderBaseURL=n.submitOrderBaseURL+n.currency+"&business="+n.businessEmail+"&handling_cart="+n.shippingCharges;i.storeLoaderStatusText.html("Loading products data...");$.ajax({type:"GET",url:n.productsXMLFile+"?file="+l.getTime(),dataType:"xml",success:function(v){$("#mainContainer").show();i.storeLoaderStatusText.html("Intializating ...");var t=0,u=0;$(v).find("category").each(function(){var y=$(this),x=y.attr("categoryName"),w=y.attr("categoryID")?e.convertToSlug(y.attr("categoryID")):t;o[w]={name:x,index:w,slug:e.convertToSlug(x)};y.find("product").each(function(){var z=$(this),A=z.attr("oldPrice"),C=z.attr("productName"),D=z.attr("productID")?e.convertToSlug(z.attr("productID")):u,E=z.attr("productPrice");var B=c[D]={name:C,slug:e.convertToSlug(C),thumbPath:z.attr("thumbPath"),price:z.attr("productPrice"),formattedPrice:e.formatAmount(E),fullFormattedPrice:e.fullFormatAmount(E),oldPrice:A?{fullFormatted:e.fullFormatAmount(A),formatted:e.formatAmount(A),price:A}:null,id:z.attr("productID"),index:D,categoryIndex:w,details:z.find("details").text(),options:{sizes:[],colors:[]}};z.find("size").each(function(){var F=$(this);B.options.sizes.push({name:F.text(),value:(F.attr("value")?F.attr("value"):F.text())})});z.find("color").each(function(){var F=$(this);B.options.colors.push({name:F.text(),value:(F.attr("value")?F.attr("value"):F.text())})});u++});t++});f.loadExistingCartItems()}}).fail(function(t){i.storeWaitingText.html("products loading failed!!");i.storeLoaderStatusText.html(t.statusText)})}}).fail(function(r){i.storeWaitingText.html("configuration loading failed!!");i.storeLoaderStatusText.html(r.statusText)});var f={setupCategories:function(){i.categoriesList.find(".active-category").after(a.sidebarCategories({categoriesCollection:o}));f.setupStore()},loadExistingCartItems:function(){var r=$.jStorage.get(g.cartStorageName),s=$.parseJSON(r);if(s&&s.length){m=s}f.updateCart();f.setupCategories()},setupStore:function(){f.onAllComplete()},categoryLinkAction:function(r){g.preventHashChangedAction=false},loadCategoryProducts:function(r){f.clearSearchResult(true);if(r=="all"){d=c;f.updateBreadCrumb("all")}else{d=_.filter(c,function(s){if(s.categoryIndex==r){return s}});f.updateBreadCrumb(o[r])}e.goToTop();i.categoriesList.find("li").removeClass("active-category");i.categoriesList.find(".category-list-item-"+r).addClass("active-category");g.lastAccessedCategory=r;f.generateProductsThumbs()},generateProductsThumbs:function(){if(i.productsContainer.data("masonry")){i.productsContainer.masonry("destroy")}i.productsContainer.html(a.productsGrid({currentProductCollection:d}));i.storeLoaderStatusText.remove();i.loaderContainer.show();i.productsContainer.imagesLoaded(function(){i.productsContainer.masonry({itemSelector:".product-item",gutter:10});$(".product-item").addClass("fade-in");i.loaderContainer.hide()})},onSearch:function(){clearTimeout(g.searchDelayTimeout);g.searchDelayTimeout=setTimeout(function(){if(i.searchInput.val()==""){return false}i.clearSearchBtn.removeAttr("disabled");var r=e.dataFromURL();if(r.hasOwnProperty("search")){if(g.preventHashChangedAction){g.preventHashChangedAction=false;return false}f.searchProduct()}else{location.hash="#/search"}},300)},clearSearchResult:function(r){i.searchInput.val("");i.clearSearchBtn.attr("disabled","");i.searchedProductCounts.html("");if(!r){f.searchProduct()}},searchProduct:function(){i.categoriesList.find("li").removeClass("active-category");var x=i.searchInput.val(),v=x.toLowerCase().split(" ");k=c;var t=[];for(var u=0;u<v.length;u++){var r=v[u];t=[];for(var s in k){var w=k[s],y=w.name.toLowerCase();if(n.searchProductDetails){y+=w.details.toLowerCase()}if(y.indexOf(r)>-1){t.push(w)}}k=t}g.lastAccessedCategory="search";i.searchedProductCounts.html(k.length+" product(s) found");if(!_.isEqual(d,k)){d=k;f.generateProductsThumbs()}},productDetails:function(r){q=c[r];if(!q){return false}j={color:(q.options.colors&&q.options.colors[0])?q.options.colors[0].value:null,size:(q.options.sizes&&q.options.sizes[0])?q.options.sizes[0].value:null};b=f.itemExistInCart();i.modalContainer.html(a.productsDetailsModal({oCurrentProductData:q,categoriesCollection:o}));f.updateAddToCartBtn();f.openModal()},showShoppingCart:function(r){i.modalContainer.html(a.shoppingCartModal({cartProductsCollection:m,allProductsCollection:c,configOptions:n,fnMisc:e,generalVars:g,cartStats:h}));if(r&&r.preventModelReLoad){return false}f.openModal();f.updateAddToCartBtn();if(!g.isStoreLoaded){f.loadCategoryProducts("all")}},backFromModal:function(){i.mainContainer.removeClass("main-container-addtions");if(g.preventHashChange){g.preventHashChange=false;return false}g.preventHashChangedAction=true;if(g.lastAccessedCategory=="search"){location.hash="#/search"}else{location.hash="#/category/uid-"+g.lastAccessedCategory}},updatedSelectedOption:function(t){t.preventDefault();var s=$(this),u=s.hasClass("product-size-selector"),r=s.find("option:selected").val();if(u){j.size=r}else{j.color=r}return f.updateAddToCartBtn()},addToCart:function(t){t.preventDefault();for(var s in m){var r=m[s];if(r.index==q.index&&r.size==j.size&&r.color==j.color){r.qty++;f.updateCart();return f.updateAddToCartBtn()}}m.push({index:q.index,size:j.size,color:j.color,qty:1});f.updateCart();return f.updateAddToCartBtn()},updateCart:function(){h.totalItems=0;h.subTotal=0;$.jStorage.set(g.cartStorageName,$.toJSON(m));for(var t in m){var s=m[t],r=c[s.index];if(!r){m=new Array();break}h.totalItems+=s.qty;h.subTotal+=(r.price*s.qty)}h.amountFormatted=e.fullFormatAmount(h.subTotal);g.enableOrderBtn=(m.length>0)?true:false;i.shoppingCartBtnContainer.html(a.shoppingCartBtn({cartStats:h}))},updateCartItemQty:function(){clearTimeout(g.qtyUpdateTimeout);var s=$(this),r=new Number(s.val()),t=s.data("cartrowindex");if(r<1){s.val(1);return false}g.qtyUpdateTimeout=setTimeout(function(){m[t].qty=r;f.updateCart();f.showShoppingCart({preventModelReLoad:true})},300)},removeCartItem:function(r){var s=$(this).data("cartrowindex");m.splice(s,1);f.updateCart();f.showShoppingCart({preventModelReLoad:true})},updateAddToCartBtn:function(){i.addToCartBtnContainer=$("#addToCartBtnContainer");b=f.itemExistInCart();$("#addToCartBtnContainer").html(a.addToCartBtn({nProductInCart:b}));return b},itemExistInCart:function(){for(var s in m){var r=m[s];if(r.index==q.index&&r.size==j.size&&r.color==j.color){return r.qty}}return false},updateBreadCrumbOnOver:function(){var t=$(this).data("productindex"),s=c[t],r=o[s.categoryIndex];f.updateBreadCrumb(r,s)},updateBreadCrumb:function(s,r){if(s=="all"){i.productsBreadcrumb.html('<li><a data-categoryindex="all" href="#/category/uid-all" class="category-link-all category-link">All</a></li>')}else{i.productsBreadcrumb.html('<li><a data-categoryindex="all" href="#/category/uid-all" class="category-link-all category-link">All</a></li> <span class="divider">/</span> <li><a data-categoryindex="all" href="#/category/uid-'+s.index+'" class="category-link-'+s.index+' category-link">'+s.name+"</a></li>"+((r)?' <span class="divider">/</span> <li>'+r.name+"<li>":"</li>"))}},proceedToOrderByEmail:function(r){r.preventDefault();g.preventHashChange=true;if(!g.enableOrderBtn){return false}else{f.closeAllModals();clearTimeout(g.showSubmitOrderTimeout);g.showSubmitOrderTimeout=setTimeout(function(){i.modalContainer.html(a.submitOrderFormModal);f.openModal();$("#submitOrderForm").validate();$(".required").on("keyup change",f.validateSubmitOrderForm)},500)}},submitOrder:function(t){t.preventDefault();if(!g.enableOrderBtn){return false}else{if(f.validateSubmitOrderForm()){if(g.isDemoActivate){return f.onOrderSubmitted({adminMailSent:1,customerMailSent:1})}g.enableOrderBtn=false;var s=$("#submitOrderForm").serialize(),r=n.submitOrderBaseURL+f.cartProductsURLGeneration()+"&cartLength="+(m.length+1)+"&"+s;$.ajax({url:r,type:"POST",dataType:"JSON"}).done(function(u){f.onOrderSubmitted(u)}).fail(function(){g.enableOrderBtn=false;$(".order-page-body").html("Order Submission failed, try again")})}}},onOrderSubmitted:function(r){if(r.adminMailSent){$(".order-page-header").html("Ваш заказ отправлен.")}if(r.customerMailSent){$(".order-page-body").html("В ближайшее время мы перезвоним Вам для уточнения. <br /> Детали заказа были отправленны и на указанный вами почтовый ящик.")}$("#backToCartBtn, #submitOrderBtn").hide();$(".order-page-close-btn").show();m=new Array();f.updateCart()},validateSubmitOrderForm:function(){var r=$("#submitOrderForm").valid();if(r){$("#submitOrderBtn").removeAttr("disabled")}else{$("#submitOrderBtn").attr("disabled","disabled")}return r},backToCartFromSubmitForm:function(r){r.preventDefault();f.closeAllModals();g.preventHashChange=true;clearTimeout(g.showSubmitOrderTimeout);g.showSubmitOrderTimeout=setTimeout(function(){f.showShoppingCart({preventModelReLoad:true});f.openModal()},500)},paypalCheckout:function(s){s.preventDefault();if(!g.enableOrderBtn){return false}var r=n.paypalBaseURL+f.cartProductsURLGeneration();window.open(r);return true},cartProductsURLGeneration:function(){var r=1,u="";for(var t in m){var s=m[t],v=c[s.index];u+="&item_name_"+r+"="+v.name;u+=(s.size&&(s.size!="NA"))?(" Size: "+s.size):"";u+=(s.color&&(s.color!="NA"))?(" Color: "+s.color):"";u+="&item_number_"+r+"="+v.id;u+="&amount_"+r+"="+v.price;u+="&quantity_"+r+"="+s.qty;r++}return u},closeAllModals:function(){i.modalCommon.modal("hide");$(".modal-backdrop").remove()},openModal:function(){f.closeAllModals();i.modalCommon.modal()},categoryCalled:function(r){if(!r.u){r.u="all"}r.u=(o[r.u])?r.u:"all";f.loadCategoryProducts(r.u)},productCalled:function(r){if(r.u){f.productDetails(r.u);i.mainContainer.addClass("main-container-addtions");if(!c[r.u]){f.loadCategoryProducts("all");return false}var s=c[r.u].categoryIndex;if(!g.isStoreLoaded){f.loadCategoryProducts(s)}}else{f.loadCategoryProducts("all")}},onAllComplete:function(){f.closeAllModals();var r=e.dataFromURL();if(r.hasOwnProperty("category")){if(g.preventHashChangedAction){g.preventHashChangedAction=false;return false}f.categoryCalled(r)}else{if(r.hasOwnProperty("search")){if(g.preventHashChangedAction){g.preventHashChangedAction=false;return false}f.searchProduct()}else{if(r.hasOwnProperty("product")){f.productCalled(r)}else{if(r.hasOwnProperty("shopping-cart")){f.showShoppingCart()}else{f.loadCategoryProducts("all")}}}}if(!g.isStoreLoaded){g.isStoreLoaded=true}}};$(window).on("hashchange",function(){g.hashChanged=true;f.onAllComplete()});$(window).on("resize",e.resizeNPositioin);i.categoriesList.on("click",".category-link",f.categoryLinkAction);i.modalContainer.on("click",".add-to-cart-btn",f.addToCart);i.searchInput.on("keyup",f.onSearch);i.clearSearchBtn.on("click",function(){f.clearSearchResult(false)});i.modalContainer.on("change",".option-selector",f.updatedSelectedOption);i.modalContainer.on("keyup change","input.cart-product-qty",f.updateCartItemQty);i.modalContainer.on("click",".delete-product-from-cart",f.removeCartItem);i.modalContainer.on("click","#checkoutWithPaypalBtn",f.paypalCheckout);i.modalContainer.on("click","#checkoutSubmitOrderBtn",f.proceedToOrderByEmail);i.modalContainer.on("click","#submitOrderBtn",f.submitOrder);i.modalContainer.on("click","#backToCartBtn",f.backToCartFromSubmitForm);i.goToTop.on("click",e.goToTop);i.productsContainer.on("mouseover",".product-item",f.updateBreadCrumbOnOver);i.modalCommon.on("hidden hidden.bs.modal",f.backFromModal)});